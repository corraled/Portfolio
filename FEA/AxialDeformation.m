%%%% Parameters of Tapered Bar %%%%
E = 210e9;     %%% Pa
v = 0.28;      %%% Poisson's Ratio
t = 0.002;     %%% tickness m
lbase = 0.006; %%% length at base
ltip = 0.001;  %%% length at tip
Ltot = 0.02;   %%% total length m
P =500;        %%% force applied in N
 
%%% 1D Bar Elements %%%
prompt = 'What is the number of elements? ';
n = input(prompt)
 
%%% Element break up %%%
Elements = n;        %%% Number of elements
Nodes = Elements+1;  %%% Number of nodes
 
%%% Node Locations %%%
L = Ltot/Elements;
x = zeros(Nodes,1);
x (Nodes) = Ltot;
 
%%% Area at any node location %%%
A=zeros(Nodes,1);   %Area vector
A(1)=t*lbase;       %Area at the base the  at base
A(Nodes)=t*ltip;    %Area at the  end
 
for i = 2:Elements
    x(i)=x(i-1)+L;
    A(i)=A(1)-(((A(1)-A(Nodes))/Ltot)*x(i));
end
 
%%%% Element-specific matrices %%%
K = zeros(Elements,1);
K = zeros(Nodes,Nodes,Elements);
for i = 1:Elements
    kElement(i)=((A(i)+A(i+1))*E)/(2*L);
    K(i,i,i)=kElement(i);
    K(i,i+1,i)=-kElement(i);
    K(i+1,i,i)=-kElement(i);
    K(i+1,i+1,i)=kElement(i);
end
 
%%% Assemble global system %%%
kGlobal = zeros(Nodes,Nodes);
for k=1:Elements
    kGlobal=kGlobal+K(:,:,k);
end
 
%%% Load Vector %%%
r = zeros(Nodes,1);
r(Nodes) = P ;
 
%%% Modify equation %%%
kModified = kGlobal;
kModified(1,:) = 0;
kModified(:,1) = 0;
kModified(1,1) = 1;
 
%%% Displacement %%%
d = (kModified\r)*1000
x=x*1000;
 
   plot(xs,ds)
title('SolidWorks 3-D FEA')
xlabel('Length of the bar (mm)')
ylabel('Displacement (mm)')
plot(x,d)
title('FEA with 1-D Bar Elements')
xlabel('Length of the bar (mm)')
ylabel('Displacement (mm)')
 
%%% Analytical Solution %%%
for i=1:Elements
da(i) = (((((P*x(i))/(E*(0.000012-A(i+1))))*log((0.000012/A(i+1))))*1000));
end
 
%%%% Root Mean Square Calculations %%%
%%% Analytical Solution of 10 points %%%
da= [ 0;
     0.0004143398904268087;
     0.0008681978894950221;
     0.001369914630723;
     0.001930786229086;
     0.002566650003489;
     0.003300700859809;
     0.004168898749304;
     0.005231487088896;
     0.006601401719619;
     0.008532187948705;];
 
%%% FEA solution for 2 elements %%%
d2 =[               0;
    0.002506265664160;
   0.007797270955166];
 
RMSE_2 = (((da(6)-d2(2))^2+(da(11)-d2(3))^2)/2)^(1/2)
 
%%% FEA solution for 10 elements %%%
d10 =[             0;
   0.000414078674948;
   0.000867593414177;
   0.001368846547009;
   0.001929070636645;
   0.002563991271566;
   0.003296592004167;
   0.004162392869967;
   0.005220593928168;
   0.006581138145856;
   0.008485900050617];
 
RMSE_10 = (((da(1)-d10(1))^2+(da(2)-d10(2))^2+(da(3)-d10(3))^2+(da(4)-d10(4))^2+(da(5)-d10(5))^2+(da(6)-d10(6))^2+(da(7)-d10(7))^2+(da(8)-d10(8))^2+(da(9)-d10(9))^2+(da(10)-d10(10))^2+(da(11)-d10(11))^2)/10)^(1/2)
 
%%% FEA solution for 100 elements %%%
d100 =[            0;0.000039848575413;0.000080033425725;0.000120560274762;
   0.000161434993749;0.000202663606406;0.000244252294283;0.000286207402317;
  0.000328535444645;0.000371243110671;0.000414337271412;0.000457824986133;
   0.000501713509284;0.000546010297767;0.000590723018536;0.000635859556564;
   0.000681428023185;0.000727436764846;0.000773894372279;0.000820809690130;
   0.000868191827065;0.000916050166380;0.000964394377161;0.001013234426001;
   0.001062580589337;0.001112443466425;0.001162833993006;0.001213763455700;
   0.001265243507180;0.001317286182174;0.001369903914349;0.001423109554147;
   0.001476916387615;0.001531338156323;0.001586389078426;0.001642083870962;
   0.001698437773470;0.001755466573014;0.001813186630734;0.001871614910021;
   0.001930769006442;0.001990667179548;0.002051328386706;0.002112772319118;
   0.002175019440188;0.002238091026439;0.002302009211162;0.002366797031052;
   0.002432478476044;0.002499078542644;0.002566623291040;0.002635139906319;
   0.002704656764157;0.002775203501371;0.002846811091775;0.002919511927835;
   0.002993339908640;0.003068330534811;0.003144521011002;0.003221950356724;
   0.003300659526342;0.003380691539147;0.003462091620547;0.003544907355537;
   0.003629188855748;0.003714988941548;0.003802363340849;0.003891370906492;
   0.003982073854338;0.004074538024472;0.004168833168272;0.004265033264472;
   0.004363216867810;0.004463467494377;0.004565874048396;0.004670531295910;
   0.004777540391684;0.004887009466670;0.004999054284597;0.005113798977655;
   0.005231376873011;0.005351931423945;0.005475617261917;0.005602601388901;
   0.005733064533063;0.005867202695370;0.006005228920353;0.006147375331156;
   0.006293895477676;0.006445067057419;0.006601195082399;0.006762615582803;
   0.006929699960414;0.007102860133574;0.007282554652891;0.007469296016103;
   0.007663659475772;0.007866293720960;0.008077933932600;0.008299417875014;
   0.008531705912180];
 
RMSE_100 = (((da(1)-d100(1))^2+(da(2)-d100(11))^2+(da(3)-d100(21))^2+(da(4)-d100(31))^2+(da(5)-d100(41))^2+(da(6)-d100(51))^2+(da(7)-d100(61))^2+(da(8)-d100(71))^2+(da(9)-d100(81))^2+(da(10)-d100(91))^2+(da(11)-d100(101))^2)/10)^(1/2)

%%% SolidWorks FEA %%%
ds= [ 0;
    .0002937;
    .0006099;
    .001033;
    .001456;
    .001977;
    .002482;
    .003076;
    .003820;
    .004701;
    .005883;
    .007104;
    .008682];
 
xs = [0;
    1.44;
    2.86;
    4.61;
    6.23;
    8.06;
    9.65;
    11.3;
    13.1;
    14.9;
    16.9;
    18.5;
    20.0];
 
    plot(xs,ds)
title('SolidWorks 3-D FEA')
xlabel('Length of the bar (mm)')
ylabel('Displacement (mm)')



